{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>√âquipements Individuels - OCP</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%);
      font-family: 'Montserrat', sans-serif;
      color: #2b2b2b;
      overflow-x: hidden;
    }

    /* --- HEADER --- */
    .header-section {
      text-align: center;
      padding: 60px 0 30px;
      background: linear-gradient(120deg, #178a34 0%, #28a745 100%);
      color: white;
      border-radius: 0 0 50px 50px;
      position: relative;
      overflow: hidden;
    }

    .header-section::after {
      content: "";
      position: absolute;
      bottom: -30px;
      left: 0;
      width: 100%;
      height: 60px;
      background: radial-gradient(circle at 50% 0%, rgba(255,255,255,0.4), transparent 70%);
    }

    .header-section h1 {
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 2.2rem;
    }

    /* --- SEARCH BAR --- */
    .search-bar {
      margin-top: -30px;
      background: white;
      border-radius: 50px;
      padding: 12px 25px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.08);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      transition: 0.3s;
    }

    .search-bar:hover {
      box-shadow: 0 8px 30px rgba(0,128,0,0.2);
    }

    .search-bar input {
      border: none;
      outline: none;
      flex: 1;
      font-size: 1rem;
    }

    .btn-ocp {
      background: #178a34;
      color: #fff;
      border-radius: 50px;
      padding: 8px 25px;
      transition: all .3s ease;
    }

    .btn-ocp:hover {
      background: #0e5f25;
      transform: translateY(-2px);
    }

    /* --- CARD --- */
    .equip-card {
      background: #fff;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 8px 25px rgba(0,128,0,0.05);
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(20px);
    }

    .equip-card.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .equip-card:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 12px 35px rgba(0,128,0,0.15);
    }

    .equip-card h5 {
      color: #178a34;
      font-weight: 600;
      text-align: center;
    }

    /* --- BADGE --- */
    .badge {
      font-size: 0.85rem;
      padding: 6px 10px;
      border-radius: 8px;
    }

    /* --- MODAL --- */
    .modal-content {
      border-radius: 20px;
      border: none;
      animation: fadeIn .4s ease;
    }

    .modal-header {
      background: #178a34;
      color: #fff;
      border-radius: 20px 20px 0 0;
    }

    /* --- EMPTY STATE --- */
    .empty-state {
      text-align: center;
      margin-top: 100px;
      animation: fadeIn 1s ease-in-out;
    }

    .empty-state img {
      width: 180px;
      opacity: 0.85;
      margin-bottom: 20px;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

<!-- HEADER -->
<section class="header-section">
  <h1>√âquipements Individuels</h1>
  <p class="mb-0">G√©rez, recherchez et demandez vos interventions facilement.</p>
</section>

<!-- SEARCH BAR -->
<form method="get" class="search-bar d-flex align-items-center mt-4 shadow">
  <input type="text" name="search" placeholder="üîç Rechercher un √©quipement (ID ou nom)" value="{{ search }}">
  <button class="btn btn-ocp" type="submit">Rechercher</button>
</form>

<!-- CONTENT -->
<div class="container py-5">
  <div class="row g-4">
    {% for equip in equipements %}
      <div class="col-md-4">
        <div class="equip-card">
          <h5>{{ equip.designation }}</h5>
          <hr>
          <p><strong>Fabricant :</strong> {{ equip.fabriquant }}</p>
          <p><strong>Mod√®le :</strong> {{ equip.modele }}</p>
          <p><strong>√âtat :</strong>
            <span class="badge
              {% if equip.etat == 'DISPO' %}bg-success
              {% elif equip.etat == 'EN_PANNE' %}bg-danger
              {% else %}bg-warning{% endif %}">
              {{ equip.get_etat_display }}
            </span>
          </p>
          <p><strong>Localisation :</strong> {{ equip.localisation }}</p>
          {% if equip.etat != 'MAINTENANCE' %}
            <button class="btn btn-ocp w-100 mt-2" data-bs-toggle="modal" data-bs-target="#modal{{ equip.id }}">
              üöÄ Demander une intervention
            </button>
          {% else %}
            <button class="btn btn-secondary w-100 mt-2" disabled>üõ†Ô∏è En maintenance</button>
          {% endif %}
        </div>
      </div>

      <!-- MODAL -->
      <div class="modal fade" id="modal{{ equip.id }}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <form method="post" action="">
              {% csrf_token %}
              <div class="modal-header">
                <h5 class="modal-title">Intervention ‚Äî {{ equip.designation }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <input type="hidden" name="equipement_id" value="{{ equip.id }}">
                <label for="description" class="form-label">Description du probl√®me :</label>
                {{ form.description }}
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-ocp">Envoyer</button>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Annuler</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="empty-state">
        <img src="{% static 'img/no_data.svg' %}" alt="Aucun √©quipement">
        <h4 class="fw-bold text-success">Aucun √©quipement trouv√© üòî</h4>
        <p>Essayez une autre recherche ou v√©rifiez plus tard.</p>
      </div>
    {% endfor %}
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Animation d‚Äôapparition douce des cartes
  const cards = document.querySelectorAll('.equip-card');
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) entry.target.classList.add('visible');
    });
  }, { threshold: 0.2 });
  cards.forEach(card => observer.observe(card));
</script>
</body>
</html>
